# gcc parameters
CC := $(CC)

CFLAGS += -Wall -g

# variables
targets := client

sources := $(wildcard *.c)

objects := $(patsubst %.c,%.o,$(sources))

pref := $(pref)
suf := $(suf)

suf += -lrt -lpthread


.PHONY:all

all:$(targets) clean

$(targets):$(objects)
	$(CC) $(CFLAGS) $(pref) -o $@ $(addsuffix .o, $@) \
		$(filter-out $(addsuffix .o, $(targets)), $(objects)) $(suf)

%.o:%.c
	$(CC) $(CFLAGS) $(pref) -c $(CFLAGS) $< -o $@ $(suf)

# auto generate prerequisites
%.d:%.c
	@set -e; rm -f $@; \
	$(CC) -MM $(CFLAGS) $< > $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,\1.o $@ : ,g' < $@.$$$$ > $@; \
	rm -f $@.$$$$

-include $(sources:.c=.d)

# clean all files generated by make command
.PHONY:clean veryclean
clean:
	-rm -f *.o *.d *.d.*

veryclean:
	-rm -f $(targets) *.o *.d *.d.*

